<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    <h1>您今天的股票觀察清單</h1>  
    
    <? var category = Object.keys(noteObj) ?>
    <? for(var cat in category){ ?>
        <? var catInfo = noteObj[category[cat]] ?>
        <h2><?= category[cat] ?></h2>
        <div style="overflow-x:auto;">
        <table style="height: 30px; width:100%;" cellspacing="6">
        <tbody>
        <tr style="height: 30px;">
        <td style="height: 30px; text-align: center;"><strong>指標</strong></td>
        <td style="height: 30px; text-align: center;"><strong>線圖</strong></td>
        <td style="height: 30px; text-align: center;"><strong>公司</strong></td>
        <td style="height: 30px; text-align: center;"><strong>收盤價</strong></td>
        <td style="height: 30px; text-align: center;"><strong>52週最高</strong></td>
        <td style="height: 30px; text-align: center;"><strong>52週最低</strong></td>
        <td style="height: 30px; text-align: center;"><strong>漲跌</strong></td>
        <td style="height: 30px; text-align: center;"><strong>滾動市盈率</strong></td>
        <td style="height: 30px; text-align: center;"><strong>分析</strong></td>
        <td style="height: 30px; text-align: center;"><strong>分析師數</strong></td>
        </tr>
        <? for(var i in catInfo){ ?>
            <tr style="height: 20px;">
            <td style="height: 20px; text-align: center;"> <?= catInfo[i]['sign'] ?> </td>
            <td style="height: 20px; text-align: center;"><a href="https://script.google.com/macros/s/AKfycbzbzeGJ836vYiPAtquSFeMPGCVzGDSWYTlyaPrX3tpv7KzRBJg/exec?mode=historyData&symbol=<?= catInfo[i]['companyName'] ?>(<?= catInfo[i]['symbol']?>)" target="_blank">📈</a></td>
            <td style="height: 20px; text-align: center;"><a href="<?= catInfo[i]['url']?>" target="_blank"><?= catInfo[i]['companyName'] ?> ( <?= catInfo[i]['symbol']?> )</a></td>
            <td style="height: 20px; text-align: center;"><?= catInfo[i]['price'] ?></td>
            
            <? if ((catInfo[i]['52weekHigh'] - catInfo[i]['price'])/catInfo[i]['52weekHigh'] < 0.05){ ?>
                <td style="height: 20px; text-align: center;"><span style="color: #ffffff; background-color: #008000;"><?= catInfo[i]['52weekHigh'] ?></span></td>
            <? }else{ ?>
                <td style="height: 20px; text-align: center;"><?= catInfo[i]['52weekHigh'] ?></td>
            <? }?>
            
            <? if ((catInfo[i]['price'] - catInfo[i]['52weekLow'])/catInfo[i]['price'] < 0.05){ ?>
                <td style="height: 20px; text-align: center;"><span style="color: #ffffff; background-color: #ff0000;"><?= catInfo[i]['52weekLow'] ?></span></td>
            <? }else{ ?>
                <td style="height: 20px; text-align: center;"><?= catInfo[i]['52weekLow'] ?></td>
            <? }?>
            
            <? if (catInfo[i]['delta'] > 0){ ?>
                <td style="height: 20px; text-align: center;"><strong><span style="color: #339966;"><?= (catInfo[i]['delta']* 100).toFixed(1) ?> %</span></strong></td>
            <? }else if (catInfo[i]['delta'] < 0){ ?>
                <td style="height: 20px; text-align: center;"><strong><span style="color: #ff0000;"><?= (catInfo[i]['delta']* 100).toFixed(1) ?> %</span></strong></td>
            <? }else{ ?>
                <td style="height: 20px; text-align: center;"><strong><?= (catInfo[i]['delta']* 100).toFixed(1) ?> %</strong></td>
            <? }?>
            
            <? if (catInfo[i]['TTM'] > 0){ ?>
                <td style="height: 20px; text-align: center;"><strong><span style="color: #339966;"><?= catInfo[i]['TTM'].toFixed(1) ?></span></strong></td>
            <? }else if (catInfo[i]['TTM'] < 0){ ?>
                <td style="height: 20px; text-align: center;"><strong><span style="color: #ff0000;"><?= catInfo[i]['TTM'].toFixed(1) ?></span></strong></td>
            <? }else{ ?>
                <td style="height: 20px text-align: center;;"><strong><?= catInfo[i]['TTM'].toFixed(1) ?></strong></td>
            <? }?>
            
            <? if (catInfo[i]['analysis'].includes("↗")){ ?>
                <td style="height: 20px; text-align: left;"><strong><span style="color: #339966;"><?= catInfo[i]['analysis'] ?></span></strong></td>
            <? }else if (catInfo[i]['analysis'].includes("↘")){ ?>
                <td style="height: 20px; text-align: left;"><strong><span style="color: #ff0000;"><?= catInfo[i]['analysis'] ?></span></strong></td>
            <? }else{ ?>
                <td style="height: 20px; text-align: left;"><?= catInfo[i]['analysis'] ?></td>
            <? }?>
            
            <? if (String(catInfo[i]['analystPopularity']).includes("↗")){ ?>
                <td style="height: 20px; text-align: center;"><strong><span style="color: #339966;"><?= catInfo[i]['analystPopularity'] ?></span></strong></td>
            <? }else if (String(catInfo[i]['analystPopularity']).includes("↘")){ ?>
                <td style="height: 20px; text-align: center;"><strong><span style="color: #ff0000;"><?= catInfo[i]['analystPopularity'] ?></span></strong></td>
            <? }else{ ?>
                <td style="height: 20px; text-align: center;"><?= catInfo[i]['analystPopularity'] ?></td>
            <? }?>
            
            </tr>
        <? } ?>
        </tbody>
        </table>
        </div>
    <?}?>
    
    <br>
    <p>謹慎理財，小心至上，股運亨通啦～！</p>
    <p>滾動市盈率計算方式：當前總市值除以前面四個季度的總凈利潤。簡單點想，就是 TTM 要比 PE 更加準確一點，數據來得更新一些。</p>
  </body>
</html>


