<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <base target="_self">
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163968177-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-163968177-1');
        </script>

        <title>History Charts - <?= stockSymbol ?></title>

        <!-- load Google AJAX API -->
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
        <script type="text/javascript">
        
            // Load the Visualization API and the controls package.
            google.charts.load('current', {'packages':['corechart', 'controls']});
 
            // Set a callback to run when the Google Visualization API is loaded.
            google.charts.setOnLoadCallback(drawDashboard);
 
            // Callback that creates and populates a data table,
            // instantiates a dashboard, a range slider and a pie chart,
            // passes in the data and draws it.
            function drawDashboard() {
 
                //create data table object
                var dataTable = new google.visualization.DataTable();
                
                var dateStr = '<?= date ?>';
                var priceStr = '<?= price ?>';
                var priceHighStr = '<?= priceHigh ?>';
                var priceMidStr = '<?= priceMid ?>';
                var priceLowStr = '<?= priceLow ?>';
                console.log(priceLowStr)
                Logger.log(priceLowStr)
                var pettm = '<?= priceLow ?>';
                var dateLst = [], priceLst = [], priceHighLst = [], priceMidLst = [], priceLowLst = [];
                dateStr.split(',').forEach(element => dateLst.push(element))
                priceStr.split(',').forEach(element => priceLst.push(parseFloat(element)))
                priceHighStr.split(',').forEach(element => priceHighLst.push(parseFloat(element)))
                priceMidStr.split(',').forEach(element => priceMidLst.push(parseFloat(element)))
                priceLowStr.split(',').forEach(element => priceLowLst.push(parseFloat(element)))
 
                //define columns
                dataTable.addColumn('string', '日期');
                dataTable.addColumn('number', '價錢');
                dataTable.addColumn('number', '分析師高價');
                dataTable.addColumn('number', '分析師均價');
                dataTable.addColumn('number', '分析師低價');
                
                //define rows of data
                for(var i = 0 ; i <= 20 ; i++)
                {
                    dataTable.addRows([[dateLst[i], priceLst[i], priceHighLst[i], priceMidLst[i], priceLowLst[i]]]);
                } 
                
                //instantiate our chart object
                var chart = new google.visualization.LineChart (document.getElementById('chart'));
                
                //define options for visualization
                var options = {width: 1027, 
                               height: 768,
                               title: '分析師目標價'};
 
                //draw our chart
                chart.draw(dataTable, options); 
            }
        </script> 
    </head>
 
    <body> 
        <!--Div for our chart -->
        <h3 style="text-align:center"><?= stockSymbol ?></h3>
        <div class="text-center">
          <div id="chart" align='center'></div>
        </div>
    </body>
</html>